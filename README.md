# AGV 版本查詢工具

這是一個基於Python Qt的AGV版本查詢工具，提供友善的圖形介面來連線到AGV設備並查詢build version資訊。

## 功能特色

- 🖥️ 現代化的圖形使用者介面（PyQt5/PySide2）
- 🔐 支援多種SSH認證方式（密碼、SSH金鑰、無密碼）
- 💾 連線設定記憶功能，支援多組設定儲存
- ⏰ 智慧時間篩選，可指定時間範圍查詢
- 📊 自動統計重啟次數
- 🔍 即時搜尋build version日誌
- 🎨 簡潔美觀的UI設計

## 安裝需求

### 系統需求
- Python 3.6+
- PyQt5 或 PySide2

### 安裝依賴套件
```bash
pip install PyQt5
# 或者
pip install PySide2

pip install paramiko
```

## 使用方法

### 1. 啟動應用程式
```bash
cd src
python main.py
```

### 2. SSH連線設定
在登入頁面輸入以下資訊：
- **IP Address**：AGV設備的IP位址
- **Port**：SSH服務端口（預設22）
- **Username**：SSH登入用戶名（預設root）
- **Password**：SSH登入密碼（可選）
- **不須設定密碼進行登入**：勾選以使用SSH金鑰認證

### 3. 快速選取功能
- 點擊「儲存至快速選取」保存當前連線設定
- 使用下拉選單快速選擇已儲存的連線設定
- 點擊「刪除」移除不需要的連線設定

### 4. 版本查詢功能
連線成功後會自動跳轉到查詢頁面：

#### 時間篩選
- **使用時間過濾進行篩選**：勾選以啟用時間範圍篩選
- **開始時間/結束時間**：設定查詢的時間範圍
- **快速設定**：
  - 「1小時前」：查詢最近1小時的日誌
  - 「24小時前」：查詢最近24小時的日誌

#### 搜尋功能
- 點擊「開始搜尋」開始查詢build version日誌
- 系統會自動搜尋 `/run/media/mmcblk1p1/log/agvapp/` 目錄
- 只顯示包含build version資訊的日誌文件

#### 結果顯示
- **開機時間**：系統開機的時間戳記
- **版本號**：軟體版本號碼
- **版本時間**：版本編譯時間
- **重啟統計**：顯示指定時間範圍內的重啟次數

## 檔案結構

```
src/
├── main.py              # 主程式入口
├── ui/                  # UI模組
│   ├── __init__.py
│   ├── login.py         # SSH登入介面
│   └── search.py        # 版本查詢介面
├── ssh/                 # SSH連線模組
│   ├── __init__.py
│   └── ssh_client.py    # SSH客戶端實作
├── config/              # 設定管理模組
│   ├── __init__.py
│   └── config_manager.py # 設定檔管理
└── ssh_config.json      # 連線設定檔（自動生成）
```

## 功能說明

### SSH連線狀態
- **Ready to connect**：等待連線
- **連線中...**：正在建立SSH連線
- **連線成功!**：SSH連線已建立
- **連線失敗**：SSH連線失敗，檢查設定或網路狀態

### 版本查詢狀態
- **Ready to scan log files**：準備搜尋
- **Scanning build version logs...**：正在搜尋中
- **Found X build version logs**：找到X個build version日誌
- **在 [時間] 到 [時間] 總共重開 X 次**：重啟次數統計

### 錯誤處理
應用程式會自動處理以下錯誤情況：
- SSH認證失敗（密碼錯誤、金鑰錯誤）
- 網路連線問題或連線超時
- 無效的IP地址或端口
- 檔案讀取權限問題
- 日誌目錄不存在

## 技術架構

- **GUI框架**：PyQt5/PySide2
- **SSH客戶端**：paramiko
- **多執行緒**：QThread防止UI凍結
- **設定管理**：JSON格式，支援密碼加密儲存
- **錯誤處理**：完整的例外處理機制
- **模組化設計**：分離UI、SSH、設定管理功能

## 安全性

1. **密碼加密**：連線設定中的密碼使用base64編碼儲存
2. **主機金鑰**：首次連線時自動接受主機金鑰
3. **多重認證**：支援密碼、SSH金鑰、無密碼多種認證方式
4. **安全連線**：所有操作透過SSH加密傳輸

## 注意事項

1. 確保目標AGV設備已啟用SSH服務
2. 檢查網路連線和防火牆設定
3. 對於生產環境，建議使用SSH金鑰認證
4. 日誌檔案路徑為 `/run/media/mmcblk1p1/log/agvapp/`
5. 支援的日誌檔案格式：`agvapp_YY_MM_DD_HH_MM_SS.tmp`

## 疑難排解

### 常見問題
1. **連線超時**：檢查IP地址和網路連線
2. **認證失敗**：確認用戶名和密碼正確
3. **找不到日誌**：確認AGV設備的日誌目錄路徑
4. **Qt庫錯誤**：安裝PyQt5或PySide2套件

### 日誌檔案
應用程式運行時的錯誤訊息會顯示在UI中，協助診斷問題。